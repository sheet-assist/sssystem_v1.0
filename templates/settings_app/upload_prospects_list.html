{% extends "base.html" %}

{% block title %}Prospects from Upload{% endblock %}

{% block content %}
<nav aria-label="breadcrumb">
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><a href="{% url 'settings_app:home' %}">Settings</a></li>
    <li class="breadcrumb-item"><a href="{% url 'settings_app:prospect_upload_list' %}">Uploads</a></li>
    <li class="breadcrumb-item active" aria-current="page">{{ upload.created_at|date:"m/d/Y H:i" }}</li>
  </ol>
</nav>

<div class="d-flex justify-content-between align-items-center mb-3">
  <h2 class="mb-0">Prospects from Upload</h2>
  <div>
    {% if upload and upload.file %}
      <a href="{{ upload.file.url }}" class="btn btn-sm btn-outline-secondary">Download CSV</a>
    {% endif %}
  </div>
</div>

<div class="table-responsive">
  <table class="table table-striped table-hover table-sm align-middle">
    <thead class="table-dark">
      <tr>
        <th>Case #</th>
        <th class="d-none d-md-table-cell">Type</th>
        <th class="d-none d-lg-table-cell">State / County</th>
        <th class="d-none d-lg-table-cell">Parcel ID</th>
        <th>Address</th>
        <th>Auction Date</th>
        <th class="text-end d-none d-lg-table-cell">Surplus</th>
        <th class="text-end d-none d-lg-table-cell">Sale Amount</th>
        <th class="d-none d-lg-table-cell">Sold To</th>
        <th>QA</th>
        <th class="d-none d-xl-table-cell">Workflow</th>
        <th class="d-none d-xl-table-cell">Assigned To</th>
      </tr>
    </thead>
    <tbody>
      {% for prospect in prospects %}
      <tr>
        <td>
          <a href="{% url 'prospects:detail' prospect.pk %}">{{ prospect.case_number }}</a>
        </td>
        <td class="d-none d-md-table-cell"><span class="badge bg-secondary">{{ prospect.prospect_type }}</span></td>
        <td class="d-none d-lg-table-cell">
          <div>{{ prospect.county.state.abbreviation }}</div>
          <div class="text-muted small">{{ prospect.county.name }}</div>
        </td>
        <td class="d-none d-lg-table-cell">{% if prospect.parcel_id %}{{ prospect.parcel_id }}{% else %}-{% endif %}</td>
        <td>{{ prospect.property_address|default:"-" }}</td>
        <td>{{ prospect.auction_date|date:"m/d/Y"|default:"-" }}</td>
        <td class="text-end d-none d-lg-table-cell">{% if prospect.surplus_amount %}${{ prospect.surplus_amount|floatformat:2 }}{% else %}-{% endif %}</td>
        <td class="text-end d-none d-lg-table-cell">{% if prospect.sale_amount %}${{ prospect.sale_amount|floatformat:2 }}{% else %}-{% endif %}</td>
        <td class="d-none d-lg-table-cell">{% if prospect.sold_to %}{{ prospect.sold_to }}{% else %}-{% endif %}</td>
        <td>
          {% if prospect.qualification_status == 'qualified' %}
            <span class="badge bg-success">Qualified</span>
          {% elif prospect.qualification_status == 'disqualified' %}
            <span class="badge bg-danger">Disqualified</span>
          {% else %}
            <span class="badge bg-warning text-dark">Pending</span>
          {% endif %}
        </td>
        <td class="d-none d-xl-table-cell">{{ prospect.workflow_status }}</td>
        <td class="d-none d-xl-table-cell">{% if prospect.assigned_to %}{{ prospect.assigned_to.get_full_name|default:prospect.assigned_to.username }}{% else %}<span class="text-muted">Unassigned</span>{% endif %}</td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="10" class="text-center text-muted py-4">No prospects found for this upload.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

{% include "includes/pagination.html" with page_obj=page_obj %}

{% endblock %}
