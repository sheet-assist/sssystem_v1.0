{% extends "base.html" %}

{% block title %}County Scrape URLs{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
  <div class="d-flex justify-content-between align-items-center mb-2">
    <h3>County Scrape URLs</h3>
    <a href="{% url 'scraper:countyscrapeurl_add' %}" class="btn btn-primary btn-sm">
      <i class="bi bi-plus-lg"></i> Add URL
    </a>
  </div>

  <!-- Search/Filter Card -->
  <div class="card mb-2">
    <div class="card-body p-2">
      <form method="get" class="row g-1 align-items-end">
        <div class="col-auto">
          <label class="form-label mb-0" style="font-size: 0.85rem;">County</label>
          <input type="text" name="county" class="form-control form-control-sm" placeholder="Search county..." value="{{ county_search }}" style="font-size: 0.85rem; width: 150px;">
        </div>
        <div class="col-auto">
          <label class="form-label mb-0" style="font-size: 0.85rem;">State</label>
          <input type="text" name="state" class="form-control form-control-sm" placeholder="State name..." value="{{ state_search }}" style="font-size: 0.85rem; width: 120px;">
        </div>
        <div class="col-auto">
          <label class="form-label mb-0" style="font-size: 0.85rem;">Type</label>
          <select name="url_type" class="form-select form-select-sm" style="font-size: 0.85rem;">
            <option value="">All Types</option>
            {% for code, label in url_types %}
            <option value="{{ code }}" {% if url_type_filter == code %}selected{% endif %}>{{ label }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="col-auto">
          <label class="form-label mb-0" style="font-size: 0.85rem;">Status</label>
          <select name="is_active" class="form-select form-select-sm" style="font-size: 0.85rem;">
            <option value="">All</option>
            <option value="true" {% if is_active_filter == "true" %}selected{% endif %}>Active</option>
            <option value="false" {% if is_active_filter == "false" %}selected{% endif %}>Inactive</option>
          </select>
        </div>
        <div class="col-auto">
          <button type="submit" class="btn btn-sm btn-primary" style="font-size: 0.8rem; padding: 0.25rem 0.5rem;">Search</button>
          <a href="{% url 'scraper:countyscrapeurl_list' %}" class="btn btn-sm btn-outline-secondary" style="font-size: 0.8rem; padding: 0.25rem 0.5rem;">Clear</a>
        </div>
      </form>
    </div>
  </div>

  {% if scrape_urls %}
  <div class="row g-1">
    {% for url in scrape_urls %}
    <div class="col-md-6 col-lg-4">
      <div class="card h-100">
        <!-- Card Header -->
        <div class="card-header bg-light border-bottom p-1" style="padding: 0.4rem !important;">
          <div class="d-flex justify-content-between align-items-start gap-1">
            <div style="flex: 1; min-width: 0;">
              <h6 class="card-title mb-0" style="font-size: 0.85rem; word-break: break-word;">
                {{ url.county.name }}
              </h6>
              <small class="text-muted">
                <span class="badge bg-info" style="font-size: 0.6rem;">{{ url.get_url_type_display }}</span>
              </small>
            </div>
            <div style="white-space: nowrap;">
              {% if url.is_active %}
              <span class="badge bg-success" style="font-size: 0.6rem;">Active</span>
              {% else %}
              <span class="badge bg-secondary" style="font-size: 0.6rem;">Inactive</span>
              {% endif %}
            </div>
          </div>
        </div>

        <!-- Card Body -->
        <div class="card-body p-1" style="padding: 0.5rem !important;">
          <div class="mb-1" style="margin-bottom: 0.25rem !important;">
            <small class="text-muted d-block" style="font-size: 0.65rem; font-weight: 600;">State</small>
            <small style="font-size: 0.7rem;">{{ url.state.name }} ({{ url.state.abbreviation }})</small>
          </div>

          <div class="mb-1" style="margin-bottom: 0.25rem !important;">
            <small class="text-muted d-block" style="font-size: 0.65rem; font-weight: 600;">URL</small>
            <small style="font-size: 0.7rem; word-break: break-all;">
              <a href="{{ url.base_url }}" target="_blank" rel="noopener noreferrer" style="color: #0066cc;">
                {{ url.base_url|truncatewords:5 }}
              </a>
            </small>
          </div>

          {% if url.notes %}
          <div class="mb-1" style="margin-bottom: 0.25rem !important;">
            <small class="text-muted d-block" style="font-size: 0.65rem; font-weight: 600;">Notes</small>
            <small style="font-size: 0.7rem;">{{ url.notes|truncatewords:5 }}</small>
          </div>
          {% endif %}

          <div>
            <small class="text-muted d-block" style="font-size: 0.65rem; font-weight: 600;">Updated</small>
            <small style="font-size: 0.7rem;">{{ url.updated_at|date:"M d, Y" }}</small>
          </div>
        </div>

        <!-- Card Footer -->
        <div class="card-footer bg-light p-1" style="padding: 0.3rem !important;">
          <div class="d-flex gap-1">
            <a href="{% url 'scraper:countyscrapeurl_edit' url.pk %}" class="btn btn-outline-primary btn-sm flex-grow-1" style="font-size: 0.65rem; padding: 0.2rem 0.25rem;">
              <i class="bi bi-pencil"></i> Edit
            </a>
            <form method="post" action="{% url 'scraper:countyscrapeurl_delete' url.pk %}" class="d-inline" onsubmit="return confirm('Delete this URL?');" style="flex: 1;">
              {% csrf_token %}
              <button type="submit" class="btn btn-outline-danger btn-sm w-100" style="font-size: 0.65rem; padding: 0.2rem 0.25rem;">
                <i class="bi bi-trash"></i> Delete
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>

  <!-- Pagination -->
  {% include "includes/pagination.html" %}

  {% else %}
  <div class="alert alert-info">
    <i class="bi bi-info-circle"></i>
    No scrape URLs configured yet.
    <a href="{% url 'scraper:countyscrapeurl_add' %}" class="alert-link">Add your first URL</a>
  </div>
  {% endif %}
</div>

<style>
  .card {
    transition: transform 0.2s, box-shadow 0.2s;
    font-size: 0.75rem;
  }

  .card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  }

  .card .small {
    font-size: 0.7rem;
    line-height: 1.2;
  }

  .card-title {
    line-height: 1.2;
  }

  .badge {
    line-height: 1;
  }
</style>
{% endblock %}
